import{r as i,u as fe,a as o,o as u,i as w,b as e,w as t,h as k,j as v,f as p,t as G,s as n,k as pe,l as Q,d as B,F as H,E as de,m as W,p as U,q as L,v as q,x as ve,y as ae,c as C,e as P,z as ne,A as X,B as Z,n as ee,T as oe,g as ue,C as ge,D as ye,G as De,H as be}from"./index-4acee792.js";import{l as ke}from"./logo-1eb6e2e9.js";const te=(a,l)=>{const g=a.__vccOpts||a;for(const[b,y]of l)g[b]=y;return g},Ve={class:"toolbar"},xe={class:"dialog-footer"},Ce={class:"dialog-footer"},we={class:"dialog-footer"},Ie={__name:"Header",setup(a){const l=i(!1),g=i(null),b=()=>{g.value=n().kanban.getKanbanTitle,l.value=!0},y=()=>{l.value=!1,g.value=n().kanban.title},r=()=>{n().kanban.setKanbanTitle(g.value),l.value=!1},V=i(!1),m=i(null),$=()=>{m.value=n().user.userInfo.name,V.value=!0},M=()=>{V.value=!1,m.value=n().user.userInfo.name},O=()=>{n().user.setUsername(m.value),V.value=!1},I=i(null),T=()=>{I.value=null,n().card.dialogGroupVisible=!0},h=()=>{n().card.dialogGroupVisible=!1,I.value=null},S=()=>{if(!I.value)return de.error("請輸入要新增的類別標題");n().card.addCard(n().card.getNewCard(I.value)),n().card.dialogGroupVisible=!1,I.value=null},E=fe(),_=()=>{n().user.loginout(),n().reset(),E.push({name:"Login"})};return(d,c)=>{const j=o("el-image"),Y=o("el-icon"),R=o("el-dropdown-item"),f=o("el-dropdown-menu"),s=o("el-dropdown"),z=o("el-header"),F=o("el-input"),A=o("el-form-item"),N=o("el-form"),x=o("el-button"),J=o("el-dialog");return u(),w(H,null,[e(z,{height:"60px"},{default:t(()=>[e(j,{src:k(ke),style:{"align-self":"center",height:"80%"}},null,8,["src"]),v("div",Ve,[e(s,null,{dropdown:t(()=>[e(f,{slot:"dropdown"},{default:t(()=>[e(R,{onClick:T},{default:t(()=>[p("新增類別群組")]),_:1}),e(R,{onClick:b},{default:t(()=>[p("編輯看板")]),_:1}),e(R,{onClick:$},{default:t(()=>[p("使用者資料")]),_:1}),e(R,{onClick:_},{default:t(()=>[p("登出")]),_:1})]),_:1})]),default:t(()=>[v("span",null,[p(G(k(n)().user.userInfo.name)+" ",1),e(Y,{style:{"margin-left":"8px"}},{default:t(()=>[e(k(pe))]),_:1})])]),_:1})])]),_:1}),e(J,{modelValue:l.value,"onUpdate:modelValue":c[2]||(c[2]=K=>l.value=K),title:"編輯看板","align-center":"",center:"",width:"400px"},{footer:t(()=>[v("span",xe,[e(x,{onClick:y},{default:t(()=>[p("取消")]),_:1}),e(x,{type:"primary",onClick:r},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[e(N,{onSubmit:c[1]||(c[1]=Q(()=>{},["prevent"]))},{default:t(()=>[e(A,{label:"看板標題"},{default:t(()=>[e(F,{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=K=>g.value=K),autocomplete:"off",onKeyup:B(r,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:V.value,"onUpdate:modelValue":c[5]||(c[5]=K=>V.value=K),title:"使用者資料","align-center":"",center:"",width:"400px"},{footer:t(()=>[v("span",Ce,[e(x,{onClick:M},{default:t(()=>[p("取消")]),_:1}),e(x,{type:"primary",onClick:O},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[e(N,{onSubmit:c[4]||(c[4]=Q(()=>{},["prevent"]))},{default:t(()=>[e(A,{label:"使用者名稱"},{default:t(()=>[e(F,{modelValue:m.value,"onUpdate:modelValue":c[3]||(c[3]=K=>m.value=K),autocomplete:"off",onKeyup:B(O,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:k(n)().card.dialogGroupVisible,"onUpdate:modelValue":c[8]||(c[8]=K=>k(n)().card.dialogGroupVisible=K),"before-close":h,title:"新增類別群組","align-center":"",center:"",width:"400px"},{footer:t(()=>[v("span",we,[e(x,{onClick:h},{default:t(()=>[p("取消")]),_:1}),e(x,{type:"primary",onClick:S},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[e(N,{onSubmit:c[7]||(c[7]=Q(()=>{},["prevent"]))},{default:t(()=>[e(A,{label:"類別名稱"},{default:t(()=>[e(F,{modelValue:I.value,"onUpdate:modelValue":c[6]||(c[6]=K=>I.value=K),autocomplete:"off",onKeyup:B(S,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},he=te(Ie,[["__scopeId","data-v-24f8b875"]]),ce="YYYY/MM/DD",se=(a,l=ce)=>a?W(a,l).toDate():W().toDate(),le=(a,l=ce)=>a&&(a!=null&&a.seconds)?W((a==null?void 0:a.seconds)*1e3).format(l):W().format(l);const Ke={style:{margin:"8px 0"}},$e={key:1,class:"text-truncat"},Ee={key:1},Ue={class:"icon-container"},Te={key:1,style:{margin:"0"}},Se={class:"text-truncat",style:{"max-width":"10rem"}},Ye={key:1,class:"text-truncat",style:{"max-width":"10rem"}},Ge={key:0},Me={style:{width:"100%","text-align-last":"center"}},Re={class:"dialog-footer"},Ne={__name:"item",props:{itemData:{type:Object},isEdit:{type:Boolean}},setup(a){const l=a,g=f=>f.replace(/[^\x00-\xff]/g,"xx").length,b=i(U(L)),y=i(U(q)),r=i(!1),V=i(null),m=i(!1),$=i(""),M=i(null),O=()=>{M.value={...l.itemData},M.value.tags=[...l.itemData.tags],r.value=!r.value,b.value=U(r.value?Z:L),y.value=U(r.value?X:q),r.value||n().item.setItem(l.itemData),ee(()=>{var f,s;return(s=(f=V.value)==null?void 0:f.input)==null?void 0:s.focus()})},I=()=>{if(r.value){r.value=!1,b.value=U(L),y.value=U(q);let f=n().item.items[l.itemData.card_id].find(s=>s.id==l.itemData.id);Object.entries(M.value).forEach(([s,z])=>f[s]=z),S.value=[h(l.itemData.start_date),h(l.itemData.end_date)];return}$.value=l.itemData.title,m.value=!0},T=()=>{m.value=!1,n().item.deleteItem(l.itemData)},h=f=>f?le(f):null,S=i([h(l.itemData.start_date),h(l.itemData.end_date)]);ve(S,f=>{f?(l.itemData.start_date=oe.fromDate(se(f[0])),l.itemData.end_date=oe.fromDate(se(f[1]))):(l.itemData.start_date=null,l.itemData.end_date=null)});const E=i(!1),_=i(null),d=i(""),c=f=>{l.itemData.tags.splice(l.itemData.tags.indexOf(f),1)},j=()=>{E.value=!0,ee(()=>_.value.input.focus())},Y=()=>{E.value=!1,d.value=""},R=()=>{E.value=!1,d.value&&l.itemData.tags.push(d.value),d.value=""};return(f,s)=>{const z=o("el-input"),F=o("el-date-picker"),A=o("el-row"),N=o("el-col"),x=o("el-button"),J=o("el-tooltip"),K=o("el-tag"),re=o("el-space"),me=o("el-card"),_e=o("el-dialog");return u(),w(H,null,[e(me,{shadow:"hover",class:"card__item item",style:ae({cursor:k(n)().device.isMobileDevice?"default":"pointer"}),"body-style":"padding: 4px;",card_id:a.itemData.card_id,item_id:a.itemData.id},{default:t(()=>[e(A,null,{default:t(()=>[e(N,{span:a.isEdit?22:21,offset:1,style:ae({"text-align":"start","padding-right":a.isEdit?"":"0.5rem"})},{default:t(()=>[v("h3",Ke,[r.value||a.isEdit?(u(),C(z,{key:0,ref_key:"InputRefItem",ref:V,modelValue:a.itemData.title,"onUpdate:modelValue":s[0]||(s[0]=D=>a.itemData.title=D),onKeyup:B(O,["enter"])},null,8,["modelValue","onKeyup"])):(u(),w("span",$e,G(a.itemData.title),1))]),r.value||a.isEdit?(u(),C(A,{key:0},{default:t(()=>[e(F,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=D=>S.value=D),type:"daterange","range-separator":"~",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"])]),_:1})):a.itemData.start_date&&a.itemData.end_date?(u(),w("span",Ee,G(k(le)(a.itemData.start_date))+" ~ "+G(k(le)(a.itemData.end_date)),1)):P("",!0)]),_:1},8,["span","style"]),a.isEdit?P("",!0):(u(),C(N,{key:0,span:2},{default:t(()=>[v("div",Ue,[e(x,{icon:b.value,text:"",circle:"",onClick:O},null,8,["icon"]),e(x,{icon:y.value,text:"",circle:"",onClick:I},null,8,["icon"])])]),_:1}))]),_:1}),a.itemData.content||r.value||a.isEdit?(u(),C(A,{key:0,justify:"center",style:ae({"padding-bottom":r.value?"":"8px"})},{default:t(()=>[e(N,{span:22},{default:t(()=>[r.value||a.isEdit?(u(),C(z,{key:0,modelValue:a.itemData.content,"onUpdate:modelValue":s[2]||(s[2]=D=>a.itemData.content=D),autosize:{minRows:2},type:"textarea",placeholder:"Input Content"},null,8,["modelValue"])):(u(),w("pre",Te,G(a.itemData.content),1))]),_:1})]),_:1},8,["style"])):P("",!0),a.itemData.tags.length>0||r.value||a.isEdit?(u(),C(A,{key:1,justify:"center"},{default:t(()=>[e(N,{span:22,style:{"text-align":"start"}},{default:t(()=>[e(re,{wrap:""},{default:t(()=>[(u(!0),w(H,null,ne(a.itemData.tags,D=>(u(),C(K,{key:D,closable:r.value||a.isEdit,onClose:tt=>c(D),round:""},{default:t(()=>[g(D)>26?(u(),C(J,{key:0,content:D,placement:"bottom-start"},{default:t(()=>[v("span",Se,G(D),1)]),_:2},1032,["content"])):(u(),w("span",Ye,G(D),1))]),_:2},1032,["closable","onClose"]))),128)),r.value||a.isEdit?(u(),w("div",Ge,[E.value?(u(),C(A,{key:0,style:{"align-items":"center"}},{default:t(()=>[e(N,{span:16},{default:t(()=>[e(z,{ref_key:"tagInputRef",ref:_,modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=D=>d.value=D),size:"small",onKeyup:B(R,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(N,{span:8},{default:t(()=>[e(x,{icon:k(X),text:"",circle:"",type:"danger",style:{"margin-left":"4px"},onClick:Y},null,8,["icon"]),e(x,{icon:k(Z),text:"",circle:"",type:"success",style:{margin:"0"},onClick:R},null,8,["icon"])]),_:1})]),_:1})):(u(),C(x,{key:1,class:"button-new-tag",size:"small",onClick:j,round:""},{default:t(()=>[p(" + New Tag ")]),_:1}))])):P("",!0)]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1},8,["style","card_id","item_id"]),e(_e,{modelValue:m.value,"onUpdate:modelValue":s[5]||(s[5]=D=>m.value=D),title:"是否刪除項目?","align-center":"",center:"",width:"400px"},{footer:t(()=>[v("span",Re,[e(x,{onClick:s[4]||(s[4]=D=>m.value=!1)},{default:t(()=>[p("取消")]),_:1}),e(x,{type:"primary",onClick:T},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[v("div",Me,G($.value),1)]),_:1},8,["modelValue"])],64)}}},ie=te(Ne,[["__scopeId","data-v-e1a66adb"]]);const Oe={class:"el-card is-hover-shadow",style:{width:"100%"}},je={style:{"margin-right":"0.5rem","margin-left":"1rem"}},Ae={key:1,class:"item-title dragTitle"},ze={class:"icon-container dragTitle"},Be=["card_id"],He={class:"card__item_append last"},Le={key:0},qe={style:{width:"100%","text-align-last":"center"}},Fe={class:"dialog-footer"},Je={__name:"card",props:{cardData:{type:Object,required:!0}},setup(a){const l=a;i(null),ue(()=>{n().item.getItemAction(l.cardData.kanban_id,l.cardData.id).then(()=>{})});const g=i(U(L)),b=i(U(q)),y=i(!1),r=i(null),V=i(null),m=()=>{V.value=l.cardData.title,y.value=!y.value,g.value=U(y.value?Z:L),b.value=U(y.value?X:q),y.value||n().card.setCardTitle(l.cardData.id,l.cardData.title),ee(()=>{var _,d;return(d=(_=r.value)==null?void 0:_.input)==null?void 0:d.focus()})},$=i(!1),M=i(""),O=()=>{if(y.value){y.value=!1,g.value=U(L),b.value=U(q);let _=n().card.cards.find(d=>d.id==l.cardData.id);_.title=V.value;return}M.value=l.cardData.title,$.value=!0},I=()=>{$.value=!1,n().card.deleteCard(l.cardData)},T=i(null),h=i(!1),S=i(null),E=_=>{_&&T.value&&(n().item.addItem(T.value),T.value={}),h.value=!h.value,_||(T.value=n().item.getNewItem(l.cardData.kanban_id,l.cardData.id)),ee(()=>{var d,c;return(c=(d=S.value)==null?void 0:d.input)==null?void 0:c.focus()})};return(_,d)=>{const c=o("el-input"),j=o("el-col"),Y=o("el-button"),R=o("el-row"),f=o("el-dialog");return u(),w(H,null,[e(j,{xs:24,sm:12,md:8,lg:6,xl:4,style:{display:"flex"},class:"card",card_id:a.cardData.id},{default:t(()=>[v("div",Oe,[e(R,{class:"card-title"},{default:t(()=>[e(j,{span:22,class:"dragTitle"},{default:t(()=>[v("h3",je,[y.value?(u(),C(c,{key:0,style:{margin:"-0.2rem"},ref_key:"InputRefCard",ref:r,modelValue:a.cardData.title,"onUpdate:modelValue":d[0]||(d[0]=s=>a.cardData.title=s),onKeyup:B(m,["enter"])},null,8,["modelValue","onKeyup"])):(u(),w("div",Ae,G(a.cardData.title),1))])]),_:1}),e(j,{span:2},{default:t(()=>[v("div",ze,[e(Y,{icon:g.value,text:"",circle:"",onClick:m},null,8,["icon"]),e(Y,{icon:b.value,text:"",circle:"",onClick:O},null,8,["icon"])])]),_:1})]),_:1}),v("div",{class:"card__item-container dragCard",card_id:a.cardData.id},[(u(!0),w(H,null,ne(k(n)().item.items[a.cardData.id],s=>(u(),C(ie,{key:s.id,itemData:s,isEdit:!1},null,8,["itemData"]))),128)),v("div",He,[h.value?(u(),w("div",Le,[e(ie,{itemData:T.value,isEdit:!0},null,8,["itemData"]),e(R,{style:{"margin-top":"8px"}},{default:t(()=>[e(j,{span:12},{default:t(()=>[e(Y,{type:"success",icon:k(Z),round:"",onClick:d[1]||(d[1]=s=>E(!0))},{default:t(()=>[p("Confirm")]),_:1},8,["icon"])]),_:1}),e(j,{span:12},{default:t(()=>[e(Y,{type:"danger",icon:k(X),round:"",onClick:d[2]||(d[2]=s=>E(!1))},{default:t(()=>[p("Cancle")]),_:1},8,["icon"])]),_:1})]),_:1})])):(u(),C(Y,{key:1,icon:k(ge),round:"",onClick:d[3]||(d[3]=s=>E(!1))},{default:t(()=>[p("Append Item")]),_:1},8,["icon"]))])],8,Be)])]),_:1},8,["card_id"]),e(f,{modelValue:$.value,"onUpdate:modelValue":d[5]||(d[5]=s=>$.value=s),title:"是否刪除類別?","align-center":"",center:"",width:"400px"},{footer:t(()=>[v("span",Fe,[e(Y,{onClick:d[4]||(d[4]=s=>$.value=!1)},{default:t(()=>[p("取消")]),_:1}),e(Y,{type:"primary",onClick:I},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[v("div",qe,G(M.value),1)]),_:1},8,["modelValue"])],64)}}},Pe=te(Je,[["__scopeId","data-v-828422ce"]]);const Qe=a=>(De("data-v-3c45f8a2"),a=a(),be(),a),We={class:"title"},Xe=Qe(()=>v("span",null,"目前尚未擁有看板，請新增一個看板！",-1)),Ze={class:"dialog-footer"},et={__name:"Kanban",setup(a){const l=()=>{const V=ye({title:"Tips",message:"請使用右上角下拉選單中的『新增類別群組』，或是點擊此卡片，來新增一個用來分類的群組吧！",offset:50,duration:5e3,onClick:()=>{V.close(),n().card.dialogGroupVisible=!0}})},g=i(n().card.dialogGroupVisible),b=i(null),y=()=>{g.value=!0},r=()=>{if(!b.value)return de.error("請輸入看板名稱");n().kanban.addKanban(b.value).then(()=>{g.value=!1,l()})};return ue(()=>{n().reset(),n().kanban.getKanbanAction(n().user.userInfo.email).then(()=>{if(!n().kanban.id){y();return}n().card.getCardAction(n().kanban.id).then(()=>{if(n().card.getSize==0){l();return}n().device.isMobileDevice||n().device.dragAll()})})}),(V,m)=>{const $=o("el-row"),M=o("el-scrollbar"),O=o("el-main"),I=o("el-input"),T=o("el-form-item"),h=o("el-form"),S=o("el-button"),E=o("el-dialog");return u(),w(H,null,[e(he),e(O,{style:{padding:"0"}},{default:t(()=>[e(M,null,{default:t(()=>[v("h2",We,G(k(n)().kanban.getKanbanTitle.split("").join(" ")),1),e($,{gutter:16,class:"card-container",style:{margin:"1rem 8px","row-gap":"16px"}},{default:t(()=>[(u(!0),w(H,null,ne(k(n)().card.cards,_=>(u(),C(Pe,{key:_.id,cardData:_},null,8,["cardData"]))),128))]),_:1})]),_:1})]),_:1}),e(E,{modelValue:g.value,"onUpdate:modelValue":m[2]||(m[2]=_=>g.value=_),title:"新增看板","align-center":"",center:"",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[v("span",Ze,[e(S,{type:"primary",onClick:r},{default:t(()=>[p("確認")]),_:1})])]),default:t(()=>[Xe,e(h,{onSubmit:m[1]||(m[1]=Q(()=>{},["prevent"])),style:{"margin-top":"16px"}},{default:t(()=>[e(T,{label:"看板標題"},{default:t(()=>[e(I,{modelValue:b.value,"onUpdate:modelValue":m[0]||(m[0]=_=>b.value=_),autocomplete:"off",onKeyup:B(r,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},nt=te(et,[["__scopeId","data-v-3c45f8a2"]]);export{nt as default};
